<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Campo Caribe Operations ‚Äì Unified Testing Dashboard</title>

  <style>
    :root{
      /* ===== Dark theme + legibility ===== */
      --bg:#020617;
      --panel:#0b1222;
      --panel-2:#0f172a;
      --card: rgba(2,6,23,.72);
      --card-2: rgba(15,23,42,.70);
      --border: rgba(148,163,184,.18);
      --border-strong: rgba(148,163,184,.28);

      --text:#e5e7eb;
      --sub:#cbd5e1;
      --muted:#94a3b8;
      --accent:#22c55e;
      --accent-2:#38bdf8;
      --danger:#ef4444;

      --shadow: 0 24px 80px rgba(0,0,0,0.75);
      --shadow-soft: 0 18px 44px rgba(0,0,0,0.45);

      --text-glow: 0 1px 0 rgba(0,0,0,.55);

      /* ===== header legibility / green language ===== */
      --hdr: #f1f5f9;
      --hdr-soft: rgba(241,245,249,.92);
      --hdr-glow: rgba(34,197,94,.18);
      --hdr-stroke: rgba(34,197,94,.45);
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica Neue,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(circle at 18% 12%, rgba(56,189,248,.12) 0, transparent 42%),
        radial-gradient(circle at 75% 28%, rgba(34,197,94,.10) 0, transparent 50%),
        radial-gradient(circle at 30% 85%, rgba(239,68,68,.08) 0, transparent 55%),
        linear-gradient(180deg, #020617 0%, #030a18 55%, #020617 100%);
      overflow:hidden;
    }

    .shell{height:100%;display:flex;flex-direction:column;}

    .topbar{
      padding:14px 16px 10px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
    }

    .brand{display:flex;flex-direction:column;gap:4px;min-width:240px;}
    .brand .title{
      font-weight:950;
      letter-spacing:.02em;
      font-size:1.12rem;
      color: var(--hdr);
      text-shadow:
        0 1px 0 rgba(0,0,0,.70),
        0 0 18px var(--hdr-glow);
    }
    .brand .subtitle{
      color:rgba(226,232,240,.78);
      font-size:.92rem;
      line-height:1.25;
      max-width: 980px;
    }

    .topbar-right{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
      min-width: 220px;
    }

    .icon-btn{
      border:1px solid var(--border);
      background: linear-gradient(135deg, rgba(2,6,23,.7), rgba(15,23,42,.7));
      color: var(--text);
      border-radius:12px;
      padding:10px 10px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      transition: background .12s ease, border-color .12s ease, transform .08s ease, box-shadow .12s ease;
      box-shadow: 0 10px 22px rgba(0,0,0,.45);
      user-select:none;
      -webkit-user-select:none;
    }
    .icon-btn:hover{
      background: linear-gradient(135deg, rgba(34,197,94,.14), rgba(56,189,248,.10));
      border-color: rgba(56,189,248,.45);
      box-shadow: 0 10px 22px rgba(56,189,248,.14);
    }
    .icon-btn:active{ transform: translateY(1px); }
    .icon-btn[aria-expanded="true"]{
      background: rgba(56,189,248,.12);
      border-color: rgba(56,189,248,.55);
      box-shadow: 0 0 0 1px rgba(56,189,248,.18) inset;
    }

    .grid9{
      width:20px;height:20px;display:grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap:3px;
    }
    .grid9 span{
      display:block;
      width:100%;height:100%;
      border-radius:3px;
      background: rgba(226,232,240,.88);
      opacity:.95;
    }

    .home-ico{
      width:20px;height:20px;display:block;
      position:relative;
    }
    .home-ico:before{
      content:"";
      position:absolute; inset:0;
      clip-path: polygon(50% 5%, 95% 40%, 85% 40%, 85% 90%, 15% 90%, 15% 40%, 5% 40%);
      background: rgba(226,232,240,.9);
      border-radius:3px;
    }

    /* =========================================================
       Pill strip (Operations only; hidden by default)
       ========================================================= */
    .tabs{
      margin:0 16px;
      padding:10px;
      border-radius:18px;
      background: rgba(15,23,42,.75);
      border:1px solid var(--border);
      box-shadow: 0 10px 34px rgba(0,0,0,.45);

      display:none;
      align-items:center;
      justify-content:flex-start;
      gap:10px;

      overflow:auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(148,163,184,.55) rgba(2,6,23,0.25);

      user-select:none;
      -webkit-user-select:none;
      touch-action: pan-x;
      position:relative;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .tabs.show{ display:flex; }

    .tabs::-webkit-scrollbar{height:6px;}
    .tabs::-webkit-scrollbar-thumb{background:rgba(148,163,184,.55);border-radius:999px;}

    .tab{
      border:1px solid rgba(148,163,184,.22);
      background: rgba(2,6,23,.55);
      color: rgba(241,245,249,.92);
      padding:10px 14px;
      border-radius:999px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:.92rem;
      font-weight:800;
      white-space:nowrap;
      transition: transform .08s ease, background .12s ease, border-color .12s ease, box-shadow .12s ease;
      user-select:none;
      -webkit-user-select:none;
      flex:0 0 auto;
      text-shadow: 0 1px 0 rgba(0,0,0,.65);
    }
    .tab:hover{ background: rgba(56,189,248,.10); border-color: rgba(56,189,248,.40); }
    .tab:active{ transform: translateY(1px); }
    .tab.active{
      color:#f8fafc;
      background: rgba(34,197,94,.16);
      border-color: rgba(34,197,94,.70);
      box-shadow:
        0 0 0 1px rgba(34,197,94,.18) inset,
        0 10px 26px rgba(34,197,94,.10);
    }

    .main{flex:1 1 auto;padding:14px 16px 16px;overflow:hidden;}

    .panel{
      height:100%;
      border-radius:18px;
      border:1px solid rgba(148,163,184,.18);
      background:
        radial-gradient(circle at top right, rgba(34,197,94,0.10), transparent 60%),
        radial-gradient(circle at 20% 20%, rgba(56,189,248,0.10), transparent 52%),
        linear-gradient(135deg, rgba(2,6,23,0.92), rgba(2,6,23,0.98));
      box-shadow: var(--shadow);
      overflow:hidden;
      display:none;
    }
    .panel.active{ display:flex; flex-direction:column; }

    .section-head{
      padding:16px 18px 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      border-bottom:1px solid rgba(148,163,184,.14);
      min-height:82px;
    }
    .section-head .head-left{flex:1 1 auto;min-width:320px;}
    .section-head h2{
      margin:0;
      font-size:1.18rem;
      letter-spacing:.012em;
      font-weight:950;
      color: var(--hdr);
      text-shadow:
        0 1px 0 rgba(0,0,0,.70),
        0 0 18px var(--hdr-glow);
      position:relative;
    }
    .section-head h2::after{
      content:"";
      display:block;
      height:2px;
      width:min(260px, 65%);
      margin-top:8px;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(34,197,94,.55), rgba(34,197,94,.12));
      opacity:.9;
    }
    .section-head p{
      margin:6px 0 0;
      color:rgba(226,232,240,.82);
      font-size:.94rem;
      line-height:1.3;
      font-weight:600;
    }

    .iframe-wrap{flex:1 1 auto;overflow:hidden;}
    iframe{width:100%;height:100%;border:0;background: transparent;}

    code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}

    /* Data Input: hide header when active (tool mode) */
    .panel.toolmode .section-head{ display:none; }
    .panel.toolmode .iframe-wrap{ height:100%; }

    /* =========================================================
       HOME (default)
       ========================================================= */
    .home-wrap{
      height:100%;
      display:flex;
      flex-direction:column;
    }
    .home-top{
      padding:18px 18px 12px;
      border-bottom:1px solid rgba(148,163,184,.14);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }
    .home-top h2{
      margin:0;
      font-size:1.22rem;
      letter-spacing:.012em;
      font-weight:950;
      color: var(--hdr);
      text-shadow:
        0 1px 0 rgba(0,0,0,.70),
        0 0 18px var(--hdr-glow);
      position:relative;
    }
    .home-top h2::after{
      content:"";
      display:block;
      height:2px;
      width:min(220px, 55%);
      margin-top:10px;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(34,197,94,.55), rgba(34,197,94,.12));
      opacity:.9;
    }
    .home-top p{
      margin:8px 0 0;
      color:rgba(226,232,240,.82);
      font-size:.98rem;
      line-height:1.3;
      max-width: 980px;
      font-weight:600;
    }

    .home-top strong{
      color: var(--hdr);
      font-weight:950;
      text-shadow: 0 1px 0 rgba(0,0,0,.65);
    }

    .home-top .mini-actions{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .mini-btn{
      border:1px solid rgba(148,163,184,.22);
      background: rgba(2,6,23,.55);
      color: var(--text);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:44px;
      user-select:none;
      -webkit-user-select:none;
      box-shadow: 0 10px 18px rgba(0,0,0,.35);
    }
    .mini-btn:hover{
      border-color: rgba(34,197,94,.35);
      background: rgba(34,197,94,.10);
    }

    .home-body{
      flex:1 1 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      overflow:hidden;
    }

    .home-stage{
      width: min(1120px, calc(100vw - 64px));
      height: min(1120px, calc(100vh - 210px));
      max-height: calc(100% - 10px);
      aspect-ratio: 1 / 1;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .home-grid{
      width:100%;
      height:100%;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      grid-template-rows: repeat(2, minmax(0, 1fr));
      gap:18px;
    }

    @media (max-width: 760px){
      .home-stage{
        height: calc(100vh - 210px);
        aspect-ratio: auto;
      }
      .home-grid{
        grid-template-columns: 1fr;
        grid-template-rows: repeat(4, minmax(0, 1fr));
      }
    }

    .big-card{
      width:100%;
      height:100%;
      border:1px solid rgba(148,163,184,.18);
      background:
        radial-gradient(circle at 80% 20%, rgba(56,189,248,.08), transparent 45%),
        linear-gradient(135deg, rgba(2,6,23,.72), rgba(15,23,42,.72));
      border-radius:18px;
      padding:18px 18px;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:flex-start;
      justify-content:flex-start;
      transition: background .12s ease, border-color .12s ease, transform .08s ease, box-shadow .12s ease;
      user-select:none;
      -webkit-user-select:none;
      text-align:left;
      min-height:0;
      overflow:hidden;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .big-card:hover{
      border-color: rgba(56,189,248,.40);
      box-shadow: 0 18px 46px rgba(0,0,0,.55);
      background:
        radial-gradient(circle at 80% 20%, rgba(56,189,248,.12), transparent 45%),
        linear-gradient(135deg, rgba(2,6,23,.78), rgba(15,23,42,.78));
    }
    .big-card:active{ transform: translateY(1px); }

    .big-card .row{
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
    }
    .big-card .ico{
      font-size:1.65rem;
      line-height:1;
      filter: brightness(1.12) saturate(1.08);
    }
    .big-card .name{
      font-size:1.32rem;
      font-weight:950;
      letter-spacing:.012em;
      color: var(--hdr);
      text-shadow:
        0 1px 0 rgba(0,0,0,.65),
        0 0 18px var(--hdr-glow);
      position:relative;
    }
    .big-card .name::after{
      content:"";
      display:block;
      height:2px;
      width:min(220px, 65%);
      margin-top:10px;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(34,197,94,.55), rgba(34,197,94,.12));
      opacity:.9;
    }
    .big-card .meta{
      font-size:1.02rem;
      color: rgba(226,232,240,.88);
      line-height:1.35;
      max-width: 56ch;
      font-weight:600;
    }

    .danger{
      border-color: rgba(239,68,68,.30);
      background:
        radial-gradient(circle at 80% 20%, rgba(239,68,68,.12), transparent 45%),
        linear-gradient(135deg, rgba(2,6,23,.72), rgba(15,23,42,.72));
    }
    .danger:hover{
      border-color: rgba(239,68,68,.55);
      background:
        radial-gradient(circle at 80% 20%, rgba(239,68,68,.18), transparent 45%),
        linear-gradient(135deg, rgba(2,6,23,.78), rgba(15,23,42,.78));
    }

    .home-level2{
      width:100%;
      height:100%;
      display:none;
    }
    .home-level2.show{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .home-crumb{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      color: rgba(226,232,240,.86);
      font-size:1.0rem;
      padding: 0 2px;
      font-weight:700;
    }
    .home-crumb strong{
      color: var(--hdr);
      font-weight:950;
      text-shadow:
        0 1px 0 rgba(0,0,0,.65),
        0 0 18px var(--hdr-glow);
    }

    .home-back{
      border:1px solid rgba(148,163,184,.22);
      background: rgba(2,6,23,.55);
      color: var(--text);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      user-select:none;
      -webkit-user-select:none;
      box-shadow: 0 10px 18px rgba(0,0,0,.35);
    }
    .home-back:hover{
      border-color: rgba(34,197,94,.35);
      background: rgba(34,197,94,.10);
    }

    .cat-grid{
      flex:1 1 auto;
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:12px;
      overflow:auto;
      padding-right: 6px;
    }
    @media (max-width: 980px){
      .cat-grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    @media (max-width: 640px){
      .cat-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    .tile{
      border:1px solid rgba(148,163,184,.18);
      background: linear-gradient(135deg, rgba(2,6,23,.55), rgba(15,23,42,.60));
      border-radius:16px;
      padding:12px 10px;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:flex-start;
      justify-content:flex-start;
      min-height:82px;
      transition: background .12s ease, border-color .12s ease, transform .08s ease, box-shadow .12s ease;
      user-select:none;
      -webkit-user-select:none;
      text-align:left;
      box-shadow: 0 10px 18px rgba(0,0,0,.30);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .tile:hover{
      border-color: rgba(56,189,248,.40);
      box-shadow: 0 14px 26px rgba(0,0,0,.42);
      background: linear-gradient(135deg, rgba(56,189,248,.10), rgba(15,23,42,.65));
    }
    .tile:active{ transform: translateY(1px); }
    .tile .ico{ font-size:1.15rem; line-height:1; }
    .tile .name{
      font-size:.98rem;
      font-weight:950;
      letter-spacing:.01em;
      color: var(--hdr);
      text-shadow:
        0 1px 0 rgba(0,0,0,.65),
        0 0 14px rgba(34,197,94,.12);
    }
    .tile .meta{
      font-size:.86rem;
      color: rgba(226,232,240,.82);
      line-height:1.2;
      font-weight:600;
    }

    .disabled{
      opacity:.55;
      cursor:not-allowed;
      filter:saturate(.7);
    }
    .disabled:hover{
      background: rgba(2,6,23,.45);
      border-color: rgba(148,163,184,.14);
      box-shadow: 0 10px 18px rgba(0,0,0,.30);
    }

    /* =========================================================
       Launcher overlay + panel
       ========================================================= */
    .launcher-overlay{
      position:fixed;
      inset:0;
      background: rgba(2,6,23,.55);
      z-index: 70000;
      display:none;
    }
    .launcher-overlay.open{ display:block; }

    .launcher{
      position:fixed;
      right:16px;
      top:66px;
      width:min(420px, calc(100vw - 32px));
      max-height:min(640px, calc(100vh - 96px));
      overflow:auto;

      border-radius:18px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.86);
      box-shadow: var(--shadow);
      z-index: 70001;

      padding:12px;
      display:none;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .launcher.open{ display:block; }

    .launcher-top{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
      padding:2px 2px 10px;
    }
    .launcher-btn{
      border:1px solid rgba(148,163,184,.22);
      background: rgba(2,6,23,.55);
      color: var(--text);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      min-width:44px;
      box-shadow: 0 10px 18px rgba(0,0,0,.30);
    }
    .launcher-btn:hover{
      border-color: rgba(56,189,248,.40);
      background: rgba(56,189,248,.10);
    }

    .screen{ display:none; }
    .screen.active{ display:block; }

    .crumb{
      padding:0 6px 6px;
      color: rgba(226,232,240,.86);
      font-size:.94rem;
      display:flex;
      align-items:center;
      gap:8px;
      border-bottom:1px solid rgba(148,163,184,.14);
      margin-bottom:6px;
      font-weight:700;
    }
    .crumb .dot{
      width:6px;height:6px;border-radius:999px;background: rgba(34,197,94,.8);
      box-shadow: 0 0 0 3px rgba(34,197,94,.10);
    }
    .crumb strong{
      color: var(--hdr);
      font-weight:950;
      text-shadow:
        0 1px 0 rgba(0,0,0,.65),
        0 0 18px var(--hdr-glow);
    }

    .launcher-home-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:12px;
      padding:6px 4px 10px;
    }
    .launcher-cat-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:10px;
      padding:10px 6px 12px;
    }
    @media (max-width: 520px){
      .launcher-cat-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    /* Toast */
    .toast{
      position:fixed;
      left:12px;
      bottom:12px;
      z-index:99999;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.88);
      color: var(--text);
      box-shadow: var(--shadow);
      font-size:12px;
      max-width:min(560px, calc(100vw - 24px));
      white-space:pre-wrap;
      display:none;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .toast .t-sub{color:rgba(226,232,240,.82);margin-top:4px;font-size:11px;}
    .toast.ok{border-color: rgba(34,197,94,.45);}
    .toast.bad{border-color: rgba(239,68,68,.55);}
  </style>
</head>

<body>
  <div class="shell">
    <div class="topbar">
      <div class="brand">
        <div class="title">Campo Caribe Operations</div>
        <div class="subtitle">Unified testing harness (Home categories + Launcher + Ops pill strip on ops dashboards).</div>
      </div>

      <div class="topbar-right">
        <button class="icon-btn" id="btnHome" aria-label="Home" title="Home">
          <span class="home-ico" aria-hidden="true"></span>
        </button>

        <button class="icon-btn" id="btnLauncher" aria-label="Open dashboard menu" aria-haspopup="dialog" aria-expanded="false" title="Dashboards">
          <div class="grid9" aria-hidden="true">
            <span></span><span></span><span></span>
            <span></span><span></span><span></span>
            <span></span><span></span><span></span>
          </div>
        </button>
      </div>
    </div>

    <div class="tabs" id="tabs" aria-label="Operations Dashboards">
      <button class="tab" data-target="p-weekly">üìä <span>Weekly Summary</span></button>
      <button class="tab" data-target="p-seeding">üå± <span>Seeding</span></button>
      <button class="tab" data-target="p-transplant">ü™¥ <span>Transplant</span></button>
      <button class="tab" data-target="p-harvest">‚úÇÔ∏è <span>Harvest</span></button>
      <button class="tab" data-target="p-packing">üì¶ <span>Packing</span></button>
      <button class="tab" data-target="p-shipments">üöö <span>Shipments</span></button>
      <button class="tab" data-target="p-sanitation">üßº <span>Sanitation</span></button>
      <button class="tab" data-target="p-inventory">üì¶ <span>S&amp;H Inventory</span></button>
    </div>

    <div class="main">
      <section class="panel active" id="p-home">
        <div class="home-wrap">
          <div class="home-top">
            <div>
              <h2>Dashboards</h2>
              <p>
                Choose a category. Clicking <strong>Operations</strong> opens the Operations dashboards list right here (no launcher needed).
                The ‚ñ¶ menu is always available too.
              </p>
            </div>
            <div class="mini-actions">
              <button class="mini-btn" id="homeBackBtn" title="Back to categories" aria-label="Back to categories" style="display:none;">‚Üê</button>
            </div>
          </div>

          <div class="home-body">
            <div class="home-stage">

              <!-- Level 1 square tiles -->
              <div class="home-grid" id="homeLevel1">
                <button class="big-card" data-home-open="ops">
                  <div class="row"><div class="ico">‚öôÔ∏è</div><div class="name">Operations</div></div>
                  <div class="meta">Weekly, seeding, transplant, harvest, packing, inventory, shipments, sanitation</div>
                </button>

                <button class="big-card" data-home-open="sales">
                  <div class="row"><div class="ico">üìà</div><div class="name">Sales &amp; Marketing</div></div>
                  <div class="meta">Coming soon</div>
                </button>

                <button class="big-card" data-home-open="team">
                  <div class="row"><div class="ico">üë•</div><div class="name">Team Tools</div></div>
                  <div class="meta">Internal utilities</div>
                </button>

                <button class="big-card danger" data-home-go="p-data">
                  <div class="row"><div class="ico">üì•</div><div class="name">Data Input</div></div>
                  <div class="meta">Write / publish master data</div>
                </button>
              </div>

              <!-- Level 2 (still inside stage) -->
              <div class="home-level2" id="homeLevel2">
                <div class="home-crumb">
                  <div id="homeCrumb"><strong>Operations</strong> ‚Äî choose a dashboard</div>
                  <button class="home-back" id="homeBackInline" aria-label="Back">‚Üê Back</button>
                </div>

                <div class="cat-grid" id="homeOps" style="display:none;">
                  <button class="tile" data-home-go="p-weekly"><div class="ico">üìä</div><div class="name">Weekly Summary</div><div class="meta">Targets + actuals</div></button>
                  <button class="tile" data-home-go="p-seeding"><div class="ico">üå±</div><div class="name">Seeding</div><div class="meta">Trays & schedule</div></button>
                  <button class="tile" data-home-go="p-transplant"><div class="ico">ü™¥</div><div class="name">Transplant</div><div class="meta">Moves & counts</div></button>
                  <button class="tile" data-home-go="p-harvest"><div class="ico">‚úÇÔ∏è</div><div class="name">Harvest</div><div class="meta">Cut plans</div></button>
                  <button class="tile" data-home-go="p-packing"><div class="ico">üì¶</div><div class="name">Packing</div><div class="meta">Pack plan</div></button>
                  <button class="tile" data-home-go="p-inventory"><div class="ico">üì¶</div><div class="name">S&amp;H Inventory</div><div class="meta">Stock view</div></button>
                  <button class="tile" data-home-go="p-shipments"><div class="ico">üöö</div><div class="name">Shipments</div><div class="meta">Forward sales</div></button>
                  <button class="tile" data-home-go="p-sanitation"><div class="ico">üßº</div><div class="name">Sanitation</div><div class="meta">Checklists</div></button>
                </div>

                <div class="cat-grid" id="homeSales" style="display:none;">
                  <button class="tile disabled" disabled><div class="ico">üíµ</div><div class="name">Sales Overview</div><div class="meta">Placeholder</div></button>
                  <button class="tile disabled" disabled><div class="ico">üìà</div><div class="name">Forecast</div><div class="meta">Placeholder</div></button>
                  <button class="tile disabled" disabled><div class="ico">üì£</div><div class="name">Campaigns</div><div class="meta">Placeholder</div></button>
                </div>

                <div class="cat-grid" id="homeTeam" style="display:none;">
                  <button class="tile disabled" disabled><div class="ico">üë•</div><div class="name">Schedule</div><div class="meta">Placeholder</div></button>
                  <button class="tile disabled" disabled><div class="ico">üßæ</div><div class="name">SOPs</div><div class="meta">Placeholder</div></button>
                  <button class="tile disabled" disabled><div class="ico">‚úÖ</div><div class="name">Issues</div><div class="meta">Placeholder</div></button>
                </div>
              </div>

            </div>
          </div>
        </div>
      </section>

      <section class="panel" id="p-data" data-hidehead="true">
        <div class="section-head">
          <div class="head-left">
            <h2>Data Input Dashboard</h2>
            <p>Loads the Data Input tool and writes Master Grow / Master Pack to localStorage (and can publish to Supabase via Worker).</p>
          </div>
          <div style="opacity:.9;color:rgba(226,232,240,.70);font-size:.88rem;">üìÑ file: <code>07.0 Data Input Dashboard.html</code></div>
        </div>
        <div class="iframe-wrap">
          <iframe id="ifr-data" data-src="07.0 Data Input Dashboard.html?v=refresh1"></iframe>
        </div>
      </section>

      <section class="panel" id="p-weekly" data-ops="true">
        <div class="section-head">
          <div class="head-left">
            <h2>Weekly Summary Dashboard</h2>
            <p>Reads Master Grow + Master Pack from <code>localStorage</code> and builds a weekly summary table (targets + actuals + %).</p>
          </div>
          <div style="opacity:.9;color:rgba(226,232,240,.70);font-size:.88rem;">üìÑ file: <code>06.0 Weekly Summary Dashboard.html</code></div>
        </div>
        <div class="iframe-wrap">
          <iframe id="ifr-weekly" data-src="06.0 Weekly Summary Dashboard.html"></iframe>
        </div>
      </section>

      <section class="panel" id="p-seeding" data-ops="true">
        <div class="section-head">
          <div class="head-left">
            <h2>Seeding Dashboard</h2>
            <p>Reads Master Grow from <code>localStorage</code> key <code>campo_master_grow_v1</code> ‚Üí <code>sheets["Master Grow"]</code>.</p>
          </div>
          <div style="opacity:.9;color:rgba(226,232,240,.70);font-size:.88rem;">üìÑ file: <code>01.0 Seeding Dashboard.html</code></div>
        </div>
        <div class="iframe-wrap">
          <iframe id="ifr-seeding" data-src="01.0 Seeding Dashboard.html"></iframe>
        </div>
      </section>

      <section class="panel" id="p-transplant" data-ops="true">
        <div class="section-head">
          <div class="head-left">
            <h2>Transplant Dashboard</h2>
            <p>Reads Master Grow from <code>localStorage</code> key <code>campo_master_grow_v1</code>.</p>
          </div>
          <div style="opacity:.9;color:rgba(226,232,240,.70);font-size:.88rem;">üìÑ file: <code>02.0 Transplant Dashboard.html</code></div>
        </div>
        <div class="iframe-wrap">
          <iframe id="ifr-transplant" data-src="02.0 Transplant Dashboard.html"></iframe>
        </div>
      </section>

      <section class="panel" id="p-harvest" data-ops="true">
        <div class="section-head">
          <div class="head-left">
            <h2>Harvest Dashboard</h2>
            <p>Reads Master Grow from <code>localStorage</code> key <code>campo_master_grow_v1</code>.</p>
          </div>
          <div style="opacity:.9;color:rgba(226,232,240,.70);font-size:.88rem;">üìÑ file: <code>03.0 Harvest Dashboard.html</code></div>
        </div>
        <div class="iframe-wrap">
          <iframe id="ifr-harvest" data-src="03.0 Harvest Dashboard.html"></iframe>
        </div>
      </section>

      <section class="panel" id="p-packing" data-ops="true">
        <div class="section-head">
          <div class="head-left">
            <h2>Packing Dashboard</h2>
            <p>Reads Master Pack from <code>localStorage</code> key <code>campo_master_pack_v1</code> ‚Üí <code>sheets["Master Pack"]</code>.</p>
          </div>
          <div style="opacity:.9;color:rgba(226,232,240,.70);font-size:.88rem;">üìÑ file: <code>04.0 Packing Dashboard.html</code></div>
        </div>
        <div class="iframe-wrap">
          <iframe id="ifr-packing" data-src="04.0 Packing Dashboard.html"></iframe>
        </div>
      </section>

      <section class="panel" id="p-shipments" data-ops="true">
        <div class="section-head">
          <div class="head-left">
            <h2>Shipments (Forward Sales) Dashboard</h2>
            <p>Reads Sales lines from the Packing upload (<code>campo_master_pack_v1</code>) and shows what ships on/after the anchor date (inclusive).</p>
          </div>
          <div style="opacity:.9;color:rgba(226,232,240,.70);font-size:.88rem;">üìÑ file: <code>09.0 Shipments Dashboard.html</code></div>
        </div>
        <div class="iframe-wrap">
          <iframe id="ifr-shipments" data-src="09.0 Shipments Dashboard.html"></iframe>
        </div>
      </section>

      <section class="panel" id="p-sanitation" data-ops="true">
        <div class="section-head">
          <div class="head-left">
            <h2>Sanitation Dashboard</h2>
            <p>Reads Master Grow from <code>localStorage</code> key <code>campo_master_grow_v1</code>.</p>
          </div>
          <div style="opacity:.9;color:rgba(226,232,240,.70);font-size:.88rem;">üìÑ file: <code>05.0 Sanitation Dashboard.html</code></div>
        </div>
        <div class="iframe-wrap">
          <iframe id="ifr-sanitation" data-src="05.0 Sanitation Dashboard.html"></iframe>
        </div>
      </section>

      <section class="panel" id="p-inventory" data-ops="true">
        <div class="section-head">
          <div class="head-left">
            <h2>S&amp;H Inventory Dashboard</h2>
            <p>Reads Master Pack (preferred) + Master Grow (fallback) from <code>localStorage</code> keys <code>campo_master_pack_v1</code> / <code>campo_master_grow_v1</code>.</p>
          </div>
          <div style="opacity:.9;color:rgba(226,232,240,.70);font-size:.88rem;">üìÑ file: <code>08.0 S&amp;H Inventory Dashboard.html</code></div>
        </div>
        <div class="iframe-wrap">
          <iframe id="ifr-inventory" data-src="08.0 S&amp;H Inventory Dashboard.html"></iframe>
        </div>
      </section>
    </div>
  </div>

  <div class="launcher-overlay" id="launcherOverlay" aria-hidden="true"></div>

  <div class="launcher" id="launcher" role="dialog" aria-modal="true" aria-label="Dashboard menu">
    <div class="launcher-top">
      <button class="launcher-btn" id="btnLauncherBack" aria-label="Back" title="Back" style="display:none;">‚Üê</button>
      <button class="launcher-btn" id="btnLauncherClose" aria-label="Close menu" title="Close">‚úï</button>
    </div>

    <div class="screen active" id="screen-home">
      <div class="crumb" style="border-bottom:none;margin-bottom:0;padding-bottom:10px;">
        <span class="dot"></span>
        <span><strong>Dashboards</strong> ‚Äî choose a category</span>
      </div>

      <div class="launcher-home-grid">
        <button class="big-card" data-action="open-category" data-category="ops">
          <div class="row"><div class="ico">‚öôÔ∏è</div><div class="name">Operations</div></div>
          <div class="meta">Weekly, seeding, transplant, harvest, packing, inventory, shipments, sanitation</div>
        </button>

        <button class="big-card" data-action="open-category" data-category="sales">
          <div class="row"><div class="ico">üìà</div><div class="name">Sales &amp; Marketing</div></div>
          <div class="meta">Coming soon</div>
        </button>

        <button class="big-card" data-action="open-category" data-category="team">
          <div class="row"><div class="ico">üë•</div><div class="name">Team Tools</div></div>
          <div class="meta">Internal utilities</div>
        </button>

        <button class="big-card danger" data-action="go-panel" data-target="p-data">
          <div class="row"><div class="ico">üì•</div><div class="name">Data Input</div></div>
          <div class="meta">Write / publish master data</div>
        </button>
      </div>
    </div>

    <div class="screen" id="screen-category">
      <div class="crumb">
        <span class="dot"></span>
        <span id="crumbText"><strong>Category</strong></span>
      </div>

      <div class="launcher-cat-grid" id="cat-ops" style="display:none;">
        <button class="tile" data-action="go-panel" data-target="p-weekly"><div class="ico">üìä</div><div class="name">Weekly Summary</div><div class="meta">Targets + actuals</div></button>
        <button class="tile" data-action="go-panel" data-target="p-seeding"><div class="ico">üå±</div><div class="name">Seeding</div><div class="meta">Trays & schedule</div></button>
        <button class="tile" data-action="go-panel" data-target="p-transplant"><div class="ico">ü™¥</div><div class="name">Transplant</div><div class="meta">Moves & counts</div></button>
        <button class="tile" data-action="go-panel" data-target="p-harvest"><div class="ico">‚úÇÔ∏è</div><div class="name">Harvest</div><div class="meta">Cut plans</div></button>
        <button class="tile" data-action="go-panel" data-target="p-packing"><div class="ico">üì¶</div><div class="name">Packing</div><div class="meta">Pack plan</div></button>
        <button class="tile" data-action="go-panel" data-target="p-inventory"><div class="ico">üì¶</div><div class="name">S&amp;H Inventory</div><div class="meta">Stock view</div></button>
        <button class="tile" data-action="go-panel" data-target="p-shipments"><div class="ico">üöö</div><div class="name">Shipments</div><div class="meta">Forward sales</div></button>
        <button class="tile" data-action="go-panel" data-target="p-sanitation"><div class="ico">üßº</div><div class="name">Sanitation</div><div class="meta">Checklists</div></button>
      </div>

      <div class="launcher-cat-grid" id="cat-sales" style="display:none;">
        <button class="tile disabled" disabled><div class="ico">üíµ</div><div class="name">Sales Overview</div><div class="meta">Placeholder</div></button>
        <button class="tile disabled" disabled><div class="ico">üìà</div><div class="name">Forecast</div><div class="meta">Placeholder</div></button>
        <button class="tile disabled" disabled><div class="ico">üì£</div><div class="name">Campaigns</div><div class="meta">Placeholder</div></button>
      </div>

      <div class="launcher-cat-grid" id="cat-team" style="display:none;">
        <button class="tile disabled" disabled><div class="ico">üë•</div><div class="name">Schedule</div><div class="meta">Placeholder</div></button>
        <button class="tile disabled" disabled><div class="ico">üßæ</div><div class="name">SOPs</div><div class="meta">Placeholder</div></button>
        <button class="tile disabled" disabled><div class="ico">‚úÖ</div><div class="name">Issues</div><div class="meta">Placeholder</div></button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">
    <div id="toastText">‚Äì</div>
    <div class="t-sub" id="toastSub">‚Äì</div>
  </div>

  <script>
    (function(){
      const WORKER_BASE = "https://campo-publisher.kevin-lopezgomez.workers.dev";
      const WORKER_HEALTH_URL = `${WORKER_BASE}/health`;
      const WORKER_GROW_URL   = `${WORKER_BASE}/data/master/grow.json`;
      const WORKER_PACK_URL   = `${WORKER_BASE}/data/master/pack.json`;

      const MASTER_GROW_KEY  = "campo_master_grow_v1";
      const MASTER_PACK_KEY  = "campo_master_pack_v1";
      const MASTER_GROW_PING = "campo_master_grow_push_ping_v1";
      const MASTER_PACK_PING = "campo_master_pack_push_ping_v1";

      const CANON_GROW_SHEET = "Master Grow";
      const CANON_PACK_SHEET = "Master Pack";

      const MSG_GROW = "MASTER_GROW_UPDATED";
      const MSG_PACK = "MASTER_PACK_UPDATED";

      const BC_NAMES = ["campo_master_bus_v1", "campo_updates_v1"];
      const bcs = [];
      for (const name of BC_NAMES) {
        try { if ("BroadcastChannel" in window) bcs.push(new BroadcastChannel(name)); } catch {}
      }

      const panels = Array.from(document.querySelectorAll(".panel"));
      const tabsWrap = document.getElementById("tabs");
      const tabButtons = Array.from(document.querySelectorAll("#tabs .tab"));

      const toast = document.getElementById("toast");
      const toastText = document.getElementById("toastText");
      const toastSub = document.getElementById("toastSub");

      const btnHome = document.getElementById("btnHome");

      const btnLauncher = document.getElementById("btnLauncher");
      const btnLauncherClose = document.getElementById("btnLauncherClose");
      const btnLauncherBack = document.getElementById("btnLauncherBack");
      const launcher = document.getElementById("launcher");
      const launcherOverlay = document.getElementById("launcherOverlay");

      const screenHome = document.getElementById("screen-home");
      const screenCategory = document.getElementById("screen-category");
      const crumbText = document.getElementById("crumbText");
      const catOps = document.getElementById("cat-ops");
      const catSales = document.getElementById("cat-sales");
      const catTeam = document.getElementById("cat-team");

      const homeLevel1 = document.getElementById("homeLevel1");
      const homeLevel2 = document.getElementById("homeLevel2");
      const homeOps = document.getElementById("homeOps");
      const homeSales = document.getElementById("homeSales");
      const homeTeam = document.getElementById("homeTeam");
      const homeCrumb = document.getElementById("homeCrumb");
      const homeBackInline = document.getElementById("homeBackInline");
      const homeBackBtn = document.getElementById("homeBackBtn");

      let toastTimer = null;
      function showToast(msg, sub, ok){
        if (!toast || !toastText || !toastSub) return;
        toast.classList.remove("ok","bad");
        toast.classList.add(ok ? "ok" : "bad");
        toastText.textContent = msg || "";
        toastSub.textContent = sub || "";
        toast.style.display = "block";
        if (toastTimer) clearTimeout(toastTimer);
        toastTimer = setTimeout(() => { toast.style.display = "none"; }, ok ? 2200 : 4200);
      }

      const IFRAME_IDS = [
        "ifr-data","ifr-weekly","ifr-seeding","ifr-transplant","ifr-harvest",
        "ifr-packing","ifr-shipments","ifr-sanitation","ifr-inventory"
      ];

      function notifyIframes(type){
        for (const id of IFRAME_IDS){
          const ifr = document.getElementById(id);
          if (ifr?.contentWindow){
            try { ifr.contentWindow.postMessage({ type, ts: Date.now() }, "*"); } catch {}
          }
        }
      }

      function broadcast(type){
        const payload = { type, ts: Date.now() };
        for (const ch of bcs) { try { ch.postMessage(payload); } catch {} }
      }

      async function workerGetJson(url){
        const bust = url + (url.includes("?") ? "&" : "?") + "ts=" + Date.now();
        const r = await fetch(bust, { cache:"no-store" });
        const t = await r.text();
        if (!r.ok) throw new Error(`HTTP ${r.status}: ${t}`);
        return JSON.parse(t);
      }

      function isObject(x){ return x && typeof x === "object" && !Array.isArray(x); }

      function normalizeMasterPayload(raw, kind){
        if (!isObject(raw)) return raw;
        const want = (kind === "grow") ? CANON_GROW_SHEET : CANON_PACK_SHEET;

        if (isObject(raw.sheets) && raw.sheets[want]) return raw;

        if (isObject(raw.sheets)) {
          const keys = Object.keys(raw.sheets);
          const wantLower = want.toLowerCase();

          let match = keys.find(k => String(k).trim().toLowerCase() === wantLower);
          if (!match && kind === "grow") match = keys.find(k => String(k).toLowerCase().includes("grow"));
          if (!match && kind === "pack") match = keys.find(k => String(k).toLowerCase().includes("pack"));

          if (match) {
            const clone = JSON.parse(JSON.stringify(raw));
            clone.sheets = clone.sheets || {};
            clone.sheets[want] = clone.sheets[match];
            return clone;
          }
        }

        if (Array.isArray(raw.headers) && Array.isArray(raw.rows)) {
          return {
            version: raw.version || "v1",
            updatedAt: raw.updatedAt || new Date().toISOString(),
            kind: raw.kind || (kind === "grow" ? "grow" : "pack"),
            sourceLabel: raw.sourceLabel || "worker",
            sheets: { [want]: { headers: raw.headers, rows: raw.rows } }
          };
        }

        return raw;
      }

      function storageContractOk(){
        const growRaw = (localStorage.getItem(MASTER_GROW_KEY) || "").trim();
        if (growRaw) { try { if (!JSON.parse(growRaw)?.sheets?.[CANON_GROW_SHEET]) return false; } catch { return false; } }
        const packRaw = (localStorage.getItem(MASTER_PACK_KEY) || "").trim();
        if (packRaw) { try { if (!JSON.parse(packRaw)?.sheets?.[CANON_PACK_SHEET]) return false; } catch { return false; } }
        return true;
      }

      async function tryHydrateFromWorker(){
        try{
          const hr = await fetch(WORKER_HEALTH_URL, { cache:"no-store" });
          if (!hr.ok) throw new Error(`Health HTTP ${hr.status}`);
          showToast("Worker connected", "Hydrating localStorage‚Ä¶", true);
        } catch(err){
          console.error("‚ùå Worker not reachable:", err);
          showToast("Worker not reachable", "Using whatever is already in localStorage.", false);
          return;
        }

        let wroteAny = false;
        const now = Date.now();

        try{
          const growJson = await workerGetJson(WORKER_GROW_URL);
          const normalizedGrow = normalizeMasterPayload(growJson, "grow");
          localStorage.setItem(MASTER_GROW_KEY, JSON.stringify(normalizedGrow));
          localStorage.setItem(MASTER_GROW_PING, String(now));
          try { window.dispatchEvent(new CustomEvent(MSG_GROW, { detail:{ key: MASTER_GROW_KEY, ts: now } })); } catch {}
          notifyIframes(MSG_GROW);
          broadcast(MSG_GROW);
          wroteAny = true;
        } catch(e){ console.warn("Grow load failed:", e); }

        try{
          const packJson = await workerGetJson(WORKER_PACK_URL);
          const normalizedPack = normalizeMasterPayload(packJson, "pack");
          localStorage.setItem(MASTER_PACK_KEY, JSON.stringify(normalizedPack));
          localStorage.setItem(MASTER_PACK_PING, String(now));
          try { window.dispatchEvent(new CustomEvent(MSG_PACK, { detail:{ key: MASTER_PACK_KEY, ts: now } })); } catch {}
          notifyIframes(MSG_PACK);
          broadcast(MSG_PACK);
          wroteAny = true;
        } catch(e){ console.warn("Pack load failed:", e); }

        if (wroteAny) {
          const ok = storageContractOk();
          showToast("Hydrated from Worker", ok ? "Contract OK (canonical Master Grow/Pack sheets present)" : "‚ö†Ô∏è Contract warning: missing canonical sheet keys", ok);
        } else {
          showToast("Worker connected", "No grow/pack loaded (files missing or errors).", false);
        }
      }

      function setTabsVisible(visible){
        if (!tabsWrap) return;
        tabsWrap.classList.toggle("show", !!visible);
      }

      function setActiveTabByPanel(panelId){
        tabButtons.forEach(b => b.classList.toggle("active", b.dataset.target === panelId));
      }

      function activate(panelId){
        panels.forEach(p => p.classList.toggle("active", p.id === panelId));
        const panel = document.getElementById(panelId);
        if (!panel) return;

        const hideHead = panel.getAttribute("data-hidehead") === "true";
        panels.forEach(p => p.classList.remove("toolmode"));
        if (hideHead) panel.classList.add("toolmode");

        const isOps = panel.getAttribute("data-ops") === "true";
        setTabsVisible(isOps);
        if (isOps) setActiveTabByPanel(panelId);

        const iframe = panel.querySelector("iframe[data-src]");
        if (iframe && !iframe.src) iframe.src = iframe.getAttribute("data-src");
      }

      if (tabsWrap){
        tabsWrap.addEventListener("click", (e) => {
          const btn = e.target.closest(".tab");
          if (!btn) return;
          const target = btn.getAttribute("data-target");
          if (target) activate(target);
        });
      }

      function homeShowLevel1(){
        homeLevel1.style.display = "grid";
        homeLevel2.classList.remove("show");
        homeBackBtn.style.display = "none";
      }

      function homeShowCategory(cat){
        homeOps.style.display = "none";
        homeSales.style.display = "none";
        homeTeam.style.display = "none";

        if (cat === "ops"){
          homeCrumb.innerHTML = "<strong>Operations</strong> ‚Äî choose a dashboard";
          homeOps.style.display = "grid";
        } else if (cat === "sales"){
          homeCrumb.innerHTML = "<strong>Sales &amp; Marketing</strong> ‚Äî coming soon";
          homeSales.style.display = "grid";
        } else if (cat === "team"){
          homeCrumb.innerHTML = "<strong>Team Tools</strong> ‚Äî internal utilities";
          homeTeam.style.display = "grid";
        }

        homeLevel1.style.display = "none";
        homeLevel2.classList.add("show");
        homeBackBtn.style.display = "inline-flex";
      }

      document.getElementById("p-home").addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if (!btn) return;

        const openCat = btn.getAttribute("data-home-open");
        const goPanel = btn.getAttribute("data-home-go");

        if (openCat){ homeShowCategory(openCat); return; }
        if (goPanel){ activate(goPanel); return; }
      });

      homeBackInline.addEventListener("click", homeShowLevel1);
      homeBackBtn.addEventListener("click", homeShowLevel1);

      let launcherScreen = "home";
      function showScreen(name){
        launcherScreen = name;
        screenHome.classList.toggle("active", name === "home");
        screenCategory.classList.toggle("active", name === "category");
        btnLauncherBack.style.display = (name === "category") ? "inline-flex" : "none";
      }

      function showLauncherCategory(cat){
        catOps.style.display = "none";
        catSales.style.display = "none";
        catTeam.style.display = "none";

        if (cat === "ops"){
          crumbText.innerHTML = "<strong>Operations</strong> ‚Äî choose a dashboard";
          catOps.style.display = "grid";
        } else if (cat === "sales"){
          crumbText.innerHTML = "<strong>Sales &amp; Marketing</strong> ‚Äî coming soon";
          catSales.style.display = "grid";
        } else if (cat === "team"){
          crumbText.innerHTML = "<strong>Team Tools</strong> ‚Äî internal utilities";
          catTeam.style.display = "grid";
        }
        showScreen("category");
      }

      function openLauncher(){
        launcher.classList.add("open");
        launcherOverlay.classList.add("open");
        launcherOverlay.setAttribute("aria-hidden", "false");
        btnLauncher.setAttribute("aria-expanded", "true");
        showScreen("home");
      }

      function closeLauncher(){
        launcher.classList.remove("open");
        launcherOverlay.classList.remove("open");
        launcherOverlay.setAttribute("aria-hidden", "true");
        btnLauncher.setAttribute("aria-expanded", "false");
      }

      function toggleLauncher(){
        const isOpen = launcher.classList.contains("open");
        isOpen ? closeLauncher() : openLauncher();
      }

      btnLauncher.addEventListener("click", toggleLauncher);
      btnLauncherClose.addEventListener("click", closeLauncher);
      launcherOverlay.addEventListener("click", closeLauncher);
      window.addEventListener("keydown", (e) => { if (e.key === "Escape") closeLauncher(); });
      btnLauncherBack.addEventListener("click", () => showScreen("home"));

      launcher.addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if (!btn) return;
        if (btn.disabled) return;

        const action = btn.getAttribute("data-action");
        if (!action) return;

        if (action === "open-category"){
          const cat = btn.getAttribute("data-category");
          if (cat) showLauncherCategory(cat);
          return;
        }
        if (action === "go-panel"){
          const target = btn.getAttribute("data-target");
          if (target){
            activate(target);
            closeLauncher();
          }
          return;
        }
      });

      btnHome.addEventListener("click", () => {
        closeLauncher();
        homeShowLevel1();
        activate("p-home");
      });

      function touchPing(type){
        const now = String(Date.now());
        if (type === MSG_GROW || type === "MASTER_GROW_UPDATED") {
          try { localStorage.setItem(MASTER_GROW_PING, now); } catch {}
        }
        if (type === MSG_PACK || type === "MASTER_PACK_UPDATED") {
          try { localStorage.setItem(MASTER_PACK_PING, now); } catch {}
        }
      }

      window.addEventListener("message", (event) => {
        const msg = event?.data || {};
        if (!msg.type) return;
        if (msg.type === MSG_GROW || msg.type === MSG_PACK || msg.type === "MASTER_GROW_UPDATED" || msg.type === "MASTER_PACK_UPDATED") {
          touchPing(msg.type);
          notifyIframes(msg.type);
          broadcast(msg.type);
          showToast("Update received", msg.type, true);
        }
      });

      for (const ch of bcs) {
        ch.onmessage = (ev) => {
          const msg = ev?.data || {};
          if (!msg.type) return;
          if (msg.type === MSG_GROW || msg.type === MSG_PACK || msg.type === "MASTER_GROW_UPDATED" || msg.type === "MASTER_PACK_UPDATED") {
            touchPing(msg.type);
            notifyIframes(msg.type);
          }
        };
      }

      let lastGrowPing = localStorage.getItem(MASTER_GROW_PING) || "";
      let lastPackPing = localStorage.getItem(MASTER_PACK_PING) || "";
      setInterval(() => {
        const g = localStorage.getItem(MASTER_GROW_PING) || "";
        const p = localStorage.getItem(MASTER_PACK_PING) || "";
        if (g !== lastGrowPing) { lastGrowPing = g; notifyIframes(MSG_GROW); broadcast(MSG_GROW); }
        if (p !== lastPackPing) { lastPackPing = p; notifyIframes(MSG_PACK); broadcast(MSG_PACK); }
      }, 1500);

      homeShowLevel1();
      activate("p-home");
      tryHydrateFromWorker();
    })();
  </script>
</body>
</html>
